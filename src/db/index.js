const path = require('path')
const Datastore = require('nedb')

const db = new Datastore({
  filename: path.join(__dirname, 'data', `.db`)
})

db.loadDatabase()
db.persistence.setAutocompactionInterval(1000 * 60 * 1)

async function save({ message }) {
    return new Promise((resolve, reject) => {
        db.insert(message, (err) => {
            if (err) return reject(err)

            resolve({ success: true })
        })
    })
}

async function find({ query }) {
    return new Promise((resolve, reject) => {
        db.find(query, (err, result) => {
            if (err) return reject(err)

            resolve({ success: true, result })
        })
    })
}

module.exports = {
    find,
    save
}